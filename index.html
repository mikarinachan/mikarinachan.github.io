<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>数学メモ</title>
  <link rel="stylesheet" href="style.css">

  <!-- MathJax -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$']]
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" defer></script>
</head>

<body>
<header>
  <h1>数学メモ</h1>
  <p>思いついた問題・証明・違和感を投げる場所</p>
</header>

<main id="timeline"></main>

<!-- Firebase + 投稿描画 -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCfyTtuLXAmibDu2ebKSTUI-_ZKFrv8Syo",
    authDomain: "math-memo-870c0.firebaseapp.com",
    projectId: "math-memo-870c0",
    storageBucket: "math-memo-870c0.firebasestorage.app",
    messagingSenderId: "396039327636",
    appId: "1:396039327636:web:028aa61574d06623240981"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  fetch("posts.json")
    .then(res => res.json())
    .then(posts => {
      const area = document.getElementById("timeline");

      posts.reverse().forEach(p => {
        const div = document.createElement("div");
        div.className = "post";

        div.innerHTML = `
          <img src="${p.thumbnail}" class="thumb">
          <div class="meta">${p.date}</div>
          <div class="content">${p.body}</div>
          <div class="explain">${p.explain}</div>

          <div class="rating">
            <span>難易度：</span>
            ${[1,2,3,4,5,6,7,8,9,10].map(n =>
              `<button data-score="${n}">${n}</button>`
            ).join("")}
          </div>
        `;

        div.querySelectorAll("button").forEach(btn => {
          btn.onclick = async () => {
            await addDoc(collection(db, "ratings"), {
              postId: p.id,
              score: Number(btn.dataset.score),
              createdAt: new Date()
            });
            alert("評価ありがとう！");
          };
        });

        area.appendChild(div);
      });

      MathJax.typeset();
    });
</script>

</body>
</html>
